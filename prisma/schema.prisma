// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Center {
  id        String   @id @default(cuid())
  name      String   @unique
  code      String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  incomeRecords  IncomeRecord[]
  expenseRecords ExpenseRecord[]

  @@map("centers")
}

model Program {
  id        String   @id @default(cuid())
  name      String   @unique
  code      String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  incomeRecords IncomeRecord[]

  @@map("programs")
}

model Partner {
  id        String   @id @default(cuid())
  name      String   @unique
  code      String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  incomeRecords IncomeRecord[]

  @@map("partners")
}

model IncomeRecord {
  id                        String   @id @default(cuid())
  month                     Int
  year                      Int
  centerId                  String
  programId                 String?
  partnerId                 String?
  numberOfClasses           Int      @default(0)
  numberOfStudents          Int      @default(0)
  revenue                   Decimal? @db.Decimal(15, 2)
  status                    String?
  notes                     String?
  uploadedFileUrl           String?

  tuitionFeeFullYear        Decimal? @db.Decimal(15,2)
  tuitionFeeHalfYear        Decimal? @db.Decimal(15,2)
  tuitionFeeDiscount        Decimal? @db.Decimal(15,2)
  tuitionFeeOld             Decimal? @db.Decimal(15,2)
  sessionCount              Int?
  sessionCountNew           Int?
  numClassesHalfFee         Int?
  numClassesFullFee         Int?
  numStudentsHalfFee        Int?
  numStudentsFullFee        Int?
  numDiscountedStudents     Int?
  discount                  Decimal? @db.Decimal(15,2)
  payType                   String?
  oldStudent                String?
  freeStudentCount          Int?
  totalTuitionFee           Decimal? @db.Decimal(15,2)
  facilitiesFee             Decimal? @db.Decimal(15,2)
  adminDeduction            Decimal? @db.Decimal(15,2)
  agentCommission           Decimal? @db.Decimal(15,2)
  teacherDeduction          Decimal? @db.Decimal(15,2)
  totalDeduction            Decimal? @db.Decimal(15,2)
  actualReceivable          Decimal? @db.Decimal(15,2)
  submittedToCenter         Decimal? @db.Decimal(15,2)
  collectionDate            DateTime?
  difference                Decimal? @db.Decimal(15,2)
  selfEnrollCount           Int?
  retentionRate             String?
  staffInvolved             String?
  hrRetention               String?
  hrContract                String?
  schoolDeductionMethod     String?
  centerDeductionMethod     String?
  contractStatus            String?
  teacherRate               String?

  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  center   Center   @relation(fields: [centerId], references: [id], onDelete: Cascade)
  program  Program? @relation(fields: [programId], references: [id], onDelete: SetNull)
  partner  Partner? @relation(fields: [partnerId], references: [id], onDelete: SetNull)

  @@index([centerId])
  @@index([programId])
  @@index([partnerId])
  @@index([year, month])
  @@map("income_records")
}

// Removed ExpenseCategory and ExpenseItem models - using free text instead

model ExpenseRecord {
  id              String   @id @default(cuid())
  month           Int
  year            Int
  centerId        String
  category        String
  item            String
  position        String?
  contractType    String?
  hours           Decimal?  @db.Decimal(10, 2)
  unitPrice       Decimal?  @db.Decimal(15, 2)
  amount          Decimal   @db.Decimal(15, 2)
  kilometers      Decimal?  @db.Decimal(10, 2)
  travelAllowance Decimal?  @db.Decimal(15, 2)
  responsible     String?
  status          String?
  total           Decimal   @db.Decimal(15, 2)
  notes           String?
  uploadedFileUrl String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  center Center @relation(fields: [centerId], references: [id], onDelete: Cascade)

  @@index([centerId])
  @@index([year, month])
  @@map("expense_records")
}
